{"version":3,"sources":["src\\router.js"],"names":["window","MODULE_TO_ROUTES","ROUTES_TO_MODEL","CURR_TAB_KEY","cached","registerModel","app","model","routeObj","getPickRouteObj","namespace","path","pathname","getRoutePath","obj","setModel2Routes","route","copyRouteObj","JSON","parse","stringify","getPathKeyRoutes","routes","length","rootRoute","childRoutes","push","forEach","i","beforeEnter","nextState","replace","next","document","onkeydown","Routers","history","component","hashHistory","name","getComponent","cb","require","ensure","AppView","getIndexRoute","tmpAuth","Cookie","get","config","cookie","auth","urlArray","self","onEnter","propTypes","PropTypes","object"],"mappings":"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","file":"router.js","sourceRoot":"C:/Users/liu.ping/helloReact","sourcesContent":["import React, { PropTypes } from 'react'\r\nimport { Router, hashHistory } from 'dva/router'\r\nimport AppView from './widget/Layout/App/appView'\r\nimport { request } from './utils'\r\nimport Cookie from 'js-cookie'\r\nimport config from './config/config'\r\n\r\n// 全局注入路由路径键值对映射\r\nwindow.MODULE_TO_ROUTES = {}\r\nwindow.ROUTES_TO_MODEL = {}\r\nwindow.CURR_TAB_KEY = '/'\r\n\r\n// DVA注册model方法\r\nconst cached = {}\r\nconst registerModel = (app, model, routeObj) => {\r\n  let { namespace, path } = getPickRouteObj(model, routeObj)\r\n  model.pathname = path\r\n  if (!cached[namespace]) {\r\n    if (!!routeObj) {\r\n      model.namespace = namespace\r\n    }\r\n    app.model(model)\r\n    cached[namespace] = 1\r\n  }\r\n}\r\n\r\n// 修改路由路径\r\nconst getRoutePath = function (routeObj) {\r\n  let path = '';\r\n  // 路由字段匹配条件修改，原来的判断条件：-1 === routeObj.path.indexOf('/home')\r\n  if ('/home' !== routeObj.path) {\r\n    path = `/home/${routeObj.path}`\r\n  } else {\r\n    path = routeObj.path\r\n  }\r\n  return path\r\n}\r\n\r\n// 获得新的路由对象\r\nconst getPickRouteObj = function (model, routeObj) {\r\n  let obj = {}\r\n  if (!routeObj) {\r\n    obj.namespace = model.namespace\r\n    obj.path = ''\r\n  } else {\r\n    obj.namespace = routeObj.namespace\r\n    obj.path = getRoutePath(routeObj)\r\n  }\r\n  return obj\r\n}\r\n\r\n// 设置路径键值对到全局models2Routes\r\nconst setModel2Routes = function (app, route) {\r\n  if (!!route.routeObj) {\r\n    let routeObj = route.routeObj\r\n    let copyRouteObj = JSON.parse(JSON.stringify(routeObj))\r\n    copyRouteObj.path = getRoutePath(copyRouteObj)\r\n    // app._models[0].state.model2Routes[route.pathKey] = route.path\r\n    window.MODULE_TO_ROUTES[routeObj.namespace] = routeObj\r\n    window.ROUTES_TO_MODEL[copyRouteObj.path] = copyRouteObj\r\n  }\r\n}\r\n\r\n// 路由路径键值对映射\r\nconst getPathKeyRoutes = function (app, routes) {\r\n  if (0 !== routes.length) {\r\n    let rootRoute = routes[routes.length-1]\r\n    let { childRoutes } = rootRoute\r\n\r\n    if (!childRoutes || 0 === childRoutes.length) {\r\n      setModel2Routes(app, rootRoute)\r\n    } else {\r\n      childRoutes.push(rootRoute)\r\n      childRoutes.forEach((route, i) => {\r\n        setModel2Routes(app, route)\r\n      })\r\n    }\r\n  }\r\n}\r\n\r\n// 进入路由之前的处理，检查是否已登录\r\nconst beforeEnter = (nextState, replace, next) => {\r\n  //进入路由先解绑所有的排序事件\r\n  document.onkeydown = \"\";\r\n  next()\r\n\r\n}\r\n\r\nconst Routers = function ({ history, app }) {\r\n  const routes = [\r\n    {\r\n      path: '/',\r\n      component: () => {\r\n        return <div> {hashHistory.push('/home')} </div>\r\n      }\r\n    },\r\n    {\r\n      path: '/login',\r\n      name: '登录',\r\n      getComponent(nextState, cb) {\r\n        require.ensure([], require => {\r\n          cb(null, require('./widget/Layout/Login/loginView'))\r\n        }, 'loginView')\r\n      },\r\n    },\r\n    {\r\n      path: 'home',\r\n      name: '默认首页',\r\n      component: AppView,\r\n      getIndexRoute(nextState, cb) {\r\n        require.ensure([], require => {\r\n          let tmpAuth = Cookie.get(config.cookie.auth)\r\n          if(!tmpAuth){\r\n            hashHistory.push('/login');\r\n            return false;\r\n          }\r\n          registerModel(app, require('./pages/default/defaultMod'))\r\n          cb(null, require('./pages/default/defaultView'))\r\n        }, 'TableDemo')\r\n      },\r\n      childRoutes: [\r\n        // 默认首页\r\n        {\r\n          path: 'index',\r\n          name: '默认首页',\r\n          routeObj: {\r\n            namespace: 'defaultModel',\r\n            path: 'index',\r\n            urlArray: []\r\n          },\r\n          getComponent(nextState, cb) {\r\n            let self = this\r\n            require.ensure([], require => {\r\n              registerModel(app, require('./pages/default/defaultMod'), self.routeObj)\r\n              cb(null, require('./pages/default/defaultView'))\r\n            }, 'defaultMod')\r\n          },\r\n          onEnter: beforeEnter\r\n        },\r\n        {\r\n          path: 'template/popUpSelect',\r\n          name: '弹框选择',\r\n          getComponent(nextState, cb) {\r\n            require.ensure([], require => {\r\n              registerModel(app, require('./pages/popUpSelect/popUpSelectMod'))\r\n              cb(null, require('./pages/popUpSelect/popUpSelectDemo'))\r\n            }, 'popUpSelectMod')\r\n          },\r\n          onEnter: beforeEnter\r\n        },\r\n        {\r\n          path: 'template/kingEditor',\r\n          name: '富文本',\r\n          getComponent(nextState, cb) {\r\n            require.ensure([], require => {\r\n              registerModel(app, require('./pages/kingEditor/kingEditorMod'))\r\n              cb(null, require('./pages/kingEditor/kingEditorDemo'))\r\n            }, 'kingEditor')\r\n          },\r\n          onEnter: beforeEnter\r\n        },\r\n        {\r\n          path: 'template/category',\r\n          name: '分类',\r\n          routeObj: {\r\n            namespace: 'prodCategoryModel',\r\n            path: 'template/category',\r\n          },\r\n          getComponent(nextState, cb) {\r\n            let self = this\r\n            require.ensure([], require => {\r\n              registerModel(app, require('./pages/category/prodCategoryMod'),self.routeObj)\r\n              cb(null, require('./pages/category/prodCategoryView'))\r\n            }, 'categoryMod')\r\n          },\r\n          onEnter: beforeEnter\r\n        },\r\n        {\r\n          path: 'template/myPage',\r\n          name: '我的页面',\r\n          routeObj: {\r\n            namespace: 'myPageModel',\r\n            path: 'template/myPage',\r\n          },\r\n          getComponent(nextState, cb) {\r\n            let self = this\r\n            require.ensure([], require => {\r\n              registerModel(app, require('./pages/myPage/myPageMod'),self.routeObj)\r\n              cb(null, require('./pages/myPage/myPageView'))\r\n            }, 'myPageMod')\r\n          },\r\n          onEnter: beforeEnter\r\n        },\r\n        // 商品管理 - 商品列表\r\n        {\r\n          path: 'goodsMgmt/goodsList',\r\n          name: '商品列表',\r\n          routeObj: {\r\n            namespace: 'goodsListModel',\r\n            path: 'goodsMgmt/goodsList',\r\n            urlArray: []\r\n          },\r\n          getComponent (nextState, cb) {\r\n            let self = this\r\n            require.ensure([], require => {\r\n              registerModel(app, require('./pages/goodsMgmt/goodsList/goodsListMod'), self.routeObj)\r\n              cb(null, require('./pages/goodsMgmt/goodsList/goodsListView'))\r\n            }, 'goodsListMod')\r\n          },\r\n          // onEnter: beforeEnter\r\n        },\r\n         // 商品管理 - 商品详情\r\n         {\r\n          path: 'goodsMgmt/goodsDetail',\r\n          name: '商品列表',\r\n          routeObj: {\r\n            namespace: 'goodsDetail',\r\n            path: 'goodsMgmt/goodsDetail',\r\n            urlArray: []\r\n          },\r\n          getComponent (nextState, cb) {\r\n            let self = this\r\n            require.ensure([], require => {\r\n              registerModel(app, require('./pages/goodsMgmt/goodsDetail/goodsDetailMod'), self.routeObj)\r\n              cb(null, require('./pages/goodsMgmt/goodsDetail/goodsDetailView'))\r\n            }, 'goodsDetailMod')\r\n          },\r\n          // onEnter: beforeEnter\r\n        },\r\n\r\n        /***********************       首页        ****************************/\r\n\r\n\r\n        /***********************       错误处理        ****************************/\r\n        {\r\n          path: '*',\r\n          name: 'error',\r\n          getComponent(nextState, cb) {\r\n            require.ensure([], require => {\r\n              cb(null, require('./widget/error/'))\r\n            }, 'error')\r\n          },\r\n          onEnter: beforeEnter\r\n        },\r\n      ],\r\n    },\r\n  ]\r\n\r\n  getPathKeyRoutes(app, routes)\r\n  return <Router history={history} routes={routes}/>\r\n}\r\n\r\nRouters.propTypes = {\r\n  history: PropTypes.object,\r\n  app: PropTypes.object,\r\n}\r\n\r\nexport default Routers\r\n"]}